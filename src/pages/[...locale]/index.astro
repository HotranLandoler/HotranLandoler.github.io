---
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

import BaseLayout from '~/layouts/BaseLayout.astro';
import MainHero from '~/components/MainHero.astro';

import GameCardFeatured from '~/components/GameCardFeatured.astro';
import cquhorrorCard from '~/images/cqu-horror/cquhorrorCard.webp';
import intoSoilCard from '~/images/into-soil/IntoSoilCard.webp';
import poopyBirdCard from '~/images/poopy-bird/PoopyBirdCard.jpg';
import crashPunkCard from '~/images/crash-punk/CrashPunkCard.jpg';
import youchatCard from '~/images/youchat/YouchatCard.avif';
import livezoneCard from '~/images/live-zone/live-zone-card.jpg';

import BlogCard from '~/components/BlogCard.astro';
import ToolCard from '~/components/ToolCard.astro';

import {
  getCurrentLocale,
  getLocaleStaticPaths,
  getTranslations,
  getLocaleUrl,
} from '~/i18n';
import PageSection from '~/components/PageSection.astro';
import ButtonLink from '~/components/ButtonLink.astro';

const locale = getCurrentLocale(Astro.params);
export const getStaticPaths = getLocaleStaticPaths;
const t = getTranslations(locale);

const allPosts = await getCollection('posts');
const firstPosts = allPosts
  .sort(function compareDate(a, b) {
    return b.data.pubDate.getTime() - a.data.pubDate.getTime();
  })
  .slice(0, 5);

function localizePath(path: string) {
  return getLocaleUrl(locale, path);
}
---

<BaseLayout title={t.site.home}>
  <main>
    <MainHero />
    <!-- 作品 -->
    <PageSection heading={t.homepage.workHeading}>
      <ButtonLink slot="links" href={localizePath('/games')} title="全部游戏"
        >{t.homepage.allGames}</ButtonLink
      >
      <div class="works">
        <GameCardFeatured
          isSpecial
          imgSrc={cquhorrorCard}
          href={localizePath('/games/cquhorror')}
          gameTitle={t.games.cquHorror.title}
        />
        <GameCardFeatured
          imgSrc={intoSoilCard}
          href={localizePath('/games/intosoil')}
          gameTitle={t.games.intoSoil.title}
        />
        <GameCardFeatured
          imgSrc={poopyBirdCard}
          href={localizePath('/games/poopybird')}
          gameTitle={t.games.poopybird.title}
        />
        <GameCardFeatured
          imgSrc={crashPunkCard}
          href={localizePath('/games/crashpunk')}
          gameTitle={t.games.crashpunk.title}
        />
        <GameCardFeatured
          imgSrc={youchatCard}
          href={localizePath('/games/youchat')}
          gameTitle={t.games.youchat.title}
        />
        <GameCardFeatured
          imgSrc={livezoneCard}
          href={localizePath('/games/livezone')}
          gameTitle={t.games.livezone.title}
        />
      </div>
    </PageSection>

    <PageSection heading={t.homepage.blogHeading}>
      <ul class="posts">
        {
          firstPosts.map((post) => (
            <li>
              <BlogCard
                url={'/posts/' + post.id}
                title={post.data.title}
                pubDate={post.data.pubDate}
                desc={post.data.description}
              />
            </li>
          ))
        }
      </ul>
    </PageSection>

    <div class="grid-blog-toolbox container">
      <!-- 博客 -->
      <section class="blog-section">
        <header>
          <span class="subheading">{t.homepage.blogSubheading}</span>
          <h2 class="heading-secondary">{t.homepage.blogHeading}</h2>
        </header>

        <div class="more-tools">
          <a
            href={getLocaleUrl(locale, '/blog/')}
            class="link--primary text-icon-container">
            {t.homepage.morePosts}
            <Icon name="mdi:arrow-right" />
          </a>
        </div>
      </section>
      <!-- 工具箱 -->
      <section class="tool-section">
        <header>
          <span class="subheading heading-tools">
            {t.homepage.toolsSubheading}
          </span>
          <h2 class="heading-secondary heading-tools">
            {t.homepage.toolsHeading}
          </h2>
        </header>
        <div class="tools">
          <ToolCard
            cardTitle={t.tools.namesFight.title}
            href={getLocaleUrl(locale, '/tools/namefight')}
            icon="mdi:sword-fight"
          />
          <ToolCard
            cardTitle={t.tools.pomodoro.title}
            href={getLocaleUrl(locale, '/tools/pomodoro')}
            icon="mdi:alarm"
          />
          <!-- <ToolCard
      title="tools.unitConverter.title"
      href={getLocaleUrl("/tools/unitconverter")}
      icon="mdi:sync"
    /> -->
          <ToolCard
            cardTitle={t.tools.random.title}
            href={getLocaleUrl(locale, '/tools/random')}
            icon="mdi:dice"
          />
          <ToolCard
            cardTitle={t.tools.spacecleaner.title}
            href={getLocaleUrl(locale, '/tools/spacecleaner')}
            icon="mdi:keyboard-space"
          />
          <ToolCard
            cardTitle={t.tools.squid.title}
            href={getLocaleUrl(locale, '/tools/squid')}
            icon="squid"
          />
        </div>
        <div class="more-tools">
          <a
            href={getLocaleUrl(locale, '/tools/')}
            class="link--primary text-icon-container">
            {t.homepage.moreTools}
            <Icon name="mdi:arrow-right" />
          </a>
        </div>
      </section>
    </div>
  </main>
</BaseLayout>

<style>
  .works {
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    gap: 2rem;
  }
  .grid-blog-toolbox {
    padding: 2rem;
    padding-bottom: 6rem;

    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
  }
  .blog-section {
    padding: 2rem 0;
  }
  .posts {
    margin-bottom: 2rem;

    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .tool-section {
    background-color: var(--color-surface);
    border-radius: 1rem;
    padding: 2rem;
  }
  .tools {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    margin-bottom: 4rem;
  }
  .more-tools {
    text-align: right;
  }

  @media (max-width: 48em) {
    .page-section {
      padding-bottom: 3rem;
    }
    .works {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    .grid-blog-toolbox {
      display: flex;
      flex-direction: column;
      gap: 5rem;
    }
  }
</style>
