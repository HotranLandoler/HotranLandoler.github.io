---
import { Icon } from 'astro-icon/components';
import BaseLayout from './BaseLayout.astro';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import {
  getCurrentLocale,
  getCurrentTranslations,
  getLocaleUrl,
  type Translations,
} from '~/i18n';

export interface Props {
  gameKey: keyof Translations['games'];
  bannerSrc: ImageMetadata;
  gameLink: string;
  srcLink: string;
  pubDate: string;
  textColor: string;
  backgroundColor: string;
  foregroundColor: string;
  primaryColor: string;
  primaryDarkColor: string;
  onPrimaryColor: string;
  surfaceColor: string;
}

const {
  gameKey,
  bannerSrc,
  gameLink,
  srcLink,
  pubDate,
  textColor,
  backgroundColor,
  foregroundColor,
  primaryColor,
  primaryDarkColor,
  onPrimaryColor,
  surfaceColor,
} = Astro.props;

type Game = (typeof t.games)['cquHorror'];

const locale = getCurrentLocale(Astro.params);
const t = getCurrentTranslations(Astro.params);
const gameTranlations = t.games[gameKey] as Game;
---

<BaseLayout title={gameTranlations.title}>
  <main>
    <div class="left">
      <h1 class="title">{gameTranlations.title}</h1>
      <a class="gap-s button-play" target="_blank" href={gameLink}>
        {gameTranlations.action}
        <Icon name="mdi:arrow-right" />
      </a>
      <div class="description">
        <slot />
      </div>
    </div>

    <Image class="banner" src={bannerSrc} alt="Game banner" />

    <aside class="info-side">
      <dl class="info-meta">
        <dt>{t.games.genre}</dt>
        <dd>{gameTranlations.genre}</dd>

        <dt>{t.games.platform}</dt>
        <dd class="platforms"><slot name="platforms" /></dd>

        <dt>{t.language}</dt>
        <dd><slot name="language" /></dd>

        <dt>{t.games.engine}</dt>
        <dd>Unity</dd>

        <dt>{t.games.pubDate}</dt>
        <dd><time>{pubDate}</time></dd>

        <dt>{t.games.sessionTime}</dt>
        <dd>{gameTranlations.session}</dd>

        <dt>{t.games.controls}</dt>
        <dd>{gameTranlations.controls}</dd>

        <dt>{t.games.src}</dt>
        <dd>
          <a class="base-link" target="_blank" href={srcLink}>
            {t.games.repo}
          </a>
        </dd>

        <dt>{t.games.team}</dt>
        <dd>
          <slot name="team" />
        </dd>
      </dl>
      <div class="img-side-container">
        <slot name="side-img" />
      </div>
    </aside>

    <div class="content">
      <article>
        <div class="info">
          <slot name="info-main" />
        </div>
      </article>
    </div>

    <a
      href={getLocaleUrl(locale, '/games/')}
      class="text-icon-container more-games">
      <Icon name="mdi:arrow-left" />
      {t.games.moregames}
    </a>
  </main>
</BaseLayout>

<style
  define:vars={{
    backgroundColor,
    primaryColor,
    onPrimaryColor,
  }}
>
  main {
    row-gap: 2rem;
  }

  main :global(p) {
    margin-bottom: 1rem;

    line-height: 2;
  }
  main :global(section) {
    margin-bottom: 3rem;
  }

  .left {
    justify-items: start;
  }

  .banner {
    display: block;
    width: 100%;
    height: auto;

    background-color: var(--backgroundColor);
  }

  .title {
    font-size: 4rem;
    line-height: 1;

    margin-bottom: 1.5rem;
  }

  .button-play {
    display: inline-flex;
    padding: 0.5rem 1.5rem;
    margin-bottom: 3rem;

    font-size: 1.2rem;
    color: var(--onPrimaryColor);

    background-color: var(--primaryColor);

    transition: border-radius 0.2s ease-out;

    &:hover {
      border-radius: 3rem;
    }
  }

  .info-meta {
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: flex-start;
    gap: 1rem;

    border-radius: 0.5rem;
  }

  .info-meta :global([data-icon]) {
    font-size: 1.5rem;
  }

  .info-meta dt,
  .info-meta dd {
    display: inline-block;
  }
  .info-meta dt {
    font-weight: bold;
  }

  .img-side-container {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  :global(.side-img) {
    height: auto;
  }

  :global(.heading-icon) {
    width: 3rem;
  }

  .platforms :global(span) {
    display: flex;
  }

  .more-games {
    justify-self: start;
    padding-top: 6rem;

    font-size: 1.5rem;
    font-weight: bold;
  }

  @media (max-width: 32em) {
    .info {
      display: flex;
      flex-direction: column;
    }
  }
</style>
